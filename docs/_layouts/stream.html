---
layout: default
---

<canvas id="testcanvas"></canvas>

<script type="text/javascript">
    var canvas = document.getElementById("testcanvas");
    canvas.width = 960;
    canvas.height = 540;
    var context = canvas.getContext('2d');
    //context.scale(0.5, 0.5);
    var img = new Image();
    img.onload = function() {
        context.drawImage(img, 0, 0);
    };
    var lastTime = 0;
    var ws = new WebSocket('wss://api.chilly.codes/switch/stream');
    ws.addEventListener('message', function(e) {
        var data = JSON.parse(e.data);
        img.src = data.data.image;
    });

    function draw() {
        if (ws.readyState === ws.OPEN && lastTime + 30 < new Date().getTime()) {
            ws.send('request');
            lastTime = new Date().getTime();
        }
        requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);

</script>